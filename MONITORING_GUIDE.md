# üîé –°–∏—Å—Ç–µ–º–∞ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É —Ç–∞ –∞–ª–µ—Ä—Ç—ñ–≤

–ü–æ–≤–Ω–∞ —Å–ø–æ—Å—Ç–µ—Ä–µ–∂—É–≤–∞–Ω—ñ—Å—Ç—å —Å–∏—Å—Ç–µ–º–∏ –¥–ª—è –≤–∏—è–≤–ª–µ–Ω–Ω—è –ø—Ä–æ–±–ª–µ–º –î–û —Ç–æ–≥–æ, —è–∫ —ó—Ö –ø–æ–º—ñ—Ç—è—Ç—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ.

## üìã –û–≥–ª—è–¥

–°–∏—Å—Ç–µ–º–∞ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É —Å–∫–ª–∞–¥–∞—î—Ç—å—Å—è –∑ —Ç—Ä—å–æ—Ö –æ—Å–Ω–æ–≤–Ω–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤:

1. **Metrics Collector** - –∑–±—ñ—Ä –º–µ—Ç—Ä–∏–∫ –∑—ñ –≤—Å—ñ—Ö —Ä—ñ–≤–Ω—ñ–≤ —Å–∏—Å—Ç–µ–º–∏
2. **Alert Manager** - —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∞–ª–µ—Ä—Ç–∞–º–∏ –∑ –∑–∞—Ö–∏—Å—Ç–æ–º –≤—ñ–¥ alert fatigue
3. **Monitoring Manager** - –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü—ñ—è –ø–µ—Ä–µ–≤—ñ—Ä–æ–∫ –∑–¥–æ—Ä–æ–≤'—è —Ç–∞ –¥–æ—Å—Ç–∞–≤–∫–∏ –∞–ª–µ—Ä—Ç—ñ–≤

## üéØ –†—ñ–≤–Ω—ñ —Å–ø–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω–Ω—è

### 1. System Level (—Ä—ñ–≤–µ–Ω—å —Å–∏—Å—Ç–µ–º–∏)
–í—ñ–¥—Å—Ç–µ–∂—É—î:
- Uptime –ø—Ä–æ—Ü–µ—Å—É
- –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –ø–∞–º'—è—Ç—ñ (heap, RSS)
- –†–µ—Å—Ç–∞—Ä—Ç–∏
- Process ID —Ç–∞ –≤–µ—Ä—Å—ñ—è Node.js

**–ê–ª–µ—Ä—Ç–∏:**
- –í–∏—Å–æ–∫–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –ø–∞–º'—è—Ç—ñ (>500MB –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º)
- –î–æ–≤–≥–∏–π uptime (>7 –¥–Ω—ñ–≤, —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫)

### 2. Application Level (—Ä—ñ–≤–µ–Ω—å –∑–∞—Å—Ç–æ—Å—É–Ω–∫—É)
–í—ñ–¥—Å—Ç–µ–∂—É—î:
- –ü–æ–º–∏–ª–∫–∏ (errors, exceptions)
- –ü–µ—Ä–µ—Ö–æ–¥–∏ —Å—Ç–∞–Ω—ñ–≤ (scheduler start/stop, pause on/off)
- –ö—ñ–ª—å–∫—ñ—Å—Ç—å –ø–æ–º–∏–ª–æ–∫ —Ç–∞ —É–Ω—ñ–∫–∞–ª—å–Ω–∏—Ö –ø–æ–º–∏–ª–æ–∫

**–ê–ª–µ—Ä—Ç–∏:**
- –°–ø–ª–µ—Å–∫ –ø–æ–º–∏–ª–æ–∫ (>10 –ø–æ–º–∏–ª–æ–∫ –∑–∞ 5 —Ö–≤–∏–ª–∏–Ω)
- –ü–æ–≤—Ç–æ—Ä—é–≤–∞–Ω—ñ –ø–æ–º–∏–ª–∫–∏ (–æ–¥–Ω–∞ –ø–æ–º–∏–ª–∫–∞ >5 —Ä–∞–∑—ñ–≤)

### 3. Business Level (–ø—Ä–æ–¥—É–∫—Ç–æ–≤—ñ –º–µ—Ç—Ä–∏–∫–∏)
–í—ñ–¥—Å—Ç–µ–∂—É—î:
- –í—Å—å–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ / –∞–∫—Ç–∏–≤–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
- DAU (Daily Active Users)
- WAU (Weekly Active Users)
- –ü—ñ–¥–∫–ª—é—á–µ–Ω—ñ –∫–∞–Ω–∞–ª–∏
- IP –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥–∏

**–ê–ª–µ—Ä—Ç–∏:**
- –í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ (–∫–æ–ª–∏ DAU > 0, –∞–ª–µ active = 0)

### 4. UX Level (–ø–æ–≤–µ–¥—ñ–Ω–∫–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤)
–í—ñ–¥—Å—Ç–µ–∂—É—î:
- Cancel rate (—Å–∫–∞—Å—É–≤–∞–Ω–Ω—è –¥—ñ–π)
- Timeout rate (—Ç–∞–π–º–∞—É—Ç–∏)
- Retry count (–ø–æ–≤—Ç–æ—Ä–Ω—ñ —Å–ø—Ä–æ–±–∏)
- Quick clicks (—à–≤–∏–¥–∫—ñ –ø–æ–≤—Ç–æ—Ä–Ω—ñ –∫–ª—ñ–∫–∏)
- Abort state (–ø–µ—Ä–µ—Ä–≤–∞–Ω–∏–π wizard)

**–ê–ª–µ—Ä—Ç–∏:**
- –í–∏—Å–æ–∫–∏–π abort rate (>30% –≤–∑–∞—î–º–æ–¥—ñ–π)
- –í–∏—Å–æ–∫–∏–π cancel rate (>40% –≤–∑–∞—î–º–æ–¥—ñ–π)

### 5. IP Monitoring Level
–í—ñ–¥—Å—Ç–µ–∂—É—î:
- OFFLINE ‚Üí ONLINE –ø–µ—Ä–µ—Ö–æ–¥–∏
- UNSTABLE –∫—ñ–ª—å–∫—ñ—Å—Ç—å
- Debounce –ø–æ–¥—ñ—ó

**–ê–ª–µ—Ä—Ç–∏:**
- –ú–∞—Å–æ–≤—ñ OFFLINE ‚Üí ONLINE –ø–µ—Ä–µ—Ö–æ–¥–∏ (>100)
- –ë–∞–≥–∞—Ç–æ debounce –ø–æ–¥—ñ–π (>50)

### 6. Channel Level
–í—ñ–¥—Å—Ç–µ–∂—É—î:
- –í—Ç—Ä–∞—Ç—É –∞–¥–º—ñ–Ω-–ø—Ä–∞–≤
- –ü–æ–º–∏–ª–∫–∏ –ø—É–±–ª—ñ–∫–∞—Ü—ñ–π
- –í–∏–¥–∞–ª–µ–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å

**–ê–ª–µ—Ä—Ç–∏:**
- –í—Ç—Ä–∞—á–µ–Ω–æ –ø—Ä–∞–≤–∞ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- –ë–∞–≥–∞—Ç–æ –ø–æ–º–∏–ª–æ–∫ –ø—É–±–ª—ñ–∫–∞—Ü—ñ—ó (>10)

## üöÄ –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

### –ó–∞–ø—É—Å–∫
–°–∏—Å—Ç–µ–º–∞ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è —Ä–∞–∑–æ–º –∑ –±–æ—Ç–æ–º:

```javascript
// –í index.js
const { monitoringManager } = require('./monitoring/monitoringManager');

monitoringManager.init(bot, {
  checkIntervalMinutes: 5,
  errorSpikeThreshold: 10,
  errorSpikeWindow: 5,
  repeatedErrorThreshold: 5,
  memoryThresholdMB: 500,
  maxUptimeDays: 7
});
monitoringManager.start();
```

### –ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ñ –∫–æ–º–∞–Ω–¥–∏

#### `/monitoring`
–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –ø–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞–Ω —Å–∏—Å—Ç–µ–º–∏ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É:
- –°—Ç–∞—Ç—É—Å (–∞–∫—Ç–∏–≤–Ω–∞/–Ω–µ–∞–∫—Ç–∏–≤–Ω–∞)
- –°–∏—Å—Ç–µ–º–Ω—ñ –º–µ—Ç—Ä–∏–∫–∏ (uptime, –ø–∞–º'—è—Ç—å)
- –ú–µ—Ç—Ä–∏–∫–∏ –∑–∞—Å—Ç–æ—Å—É–Ω–∫—É (–ø–æ–º–∏–ª–∫–∏, —Ä–µ–∂–∏–º –ø–∞—É–∑–∏)
- –ë—ñ–∑–Ω–µ—Å –º–µ—Ç—Ä–∏–∫–∏ (–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ, –∫–∞–Ω–∞–ª–∏, DAU/WAU)
- –ê–ª–µ—Ä—Ç–∏ (–∑–∞ –≥–æ–¥–∏–Ω—É, –∑–∞ –¥–æ–±—É, –ø–æ —Ä—ñ–≤–Ω—è—Ö)
- –ö–∞–Ω–∞–ª –¥–ª—è –∞–ª–µ—Ä—Ç—ñ–≤

#### `/setalertchannel <channel_id>`
–ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –∫–∞–Ω–∞–ª –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –∞–ª–µ—Ä—Ç—ñ–≤:
```
/setalertchannel @my_alerts_channel
/setalertchannel -1001234567890
```

**–ü—Ä–∏–º—ñ—Ç–∫–∞:** –ë–æ—Ç –º–∞—î –±—É—Ç–∏ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º –∫–∞–Ω–∞–ª—É –∑ –ø—Ä–∞–≤–∞–º–∏ –ø—É–±–ª—ñ–∫–∞—Ü—ñ—ó.

## üìä Tracking –ø–æ–¥—ñ–π

### Tracking –ø–æ–º–∏–ª–æ–∫
```javascript
const metricsCollector = require('./monitoring/metricsCollector');

try {
  // –≤–∞—à –∫–æ–¥
} catch (error) {
  metricsCollector.trackError(error, { 
    context: 'my_function', 
    userId: user.telegram_id 
  });
}
```

### Tracking –ø–µ—Ä–µ—Ö–æ–¥—ñ–≤ —Å—Ç–∞–Ω—ñ–≤
```javascript
metricsCollector.trackStateTransition('scheduler_start', {
  interval: 60,
  timestamp: new Date().toISOString()
});
```

### Tracking UX –ø–æ–¥—ñ–π
```javascript
// Cancel
metricsCollector.trackUXEvent('cancel');

// Timeout
metricsCollector.trackUXEvent('timeout');

// Retry
metricsCollector.trackUXEvent('retry');

// Quick clicks
metricsCollector.trackUXEvent('quickClicks');

// Abort
metricsCollector.trackUXEvent('abort');
```

### Tracking IP –ø–æ–¥—ñ–π
```javascript
// OFFLINE ‚Üí ONLINE –ø–µ—Ä–µ—Ö—ñ–¥
metricsCollector.trackIPEvent('offlineToOnline');

// Unstable —Å—Ç–∞–Ω
metricsCollector.trackIPEvent('unstableCount');

// Debounce –ø–æ–¥—ñ—è
metricsCollector.trackIPEvent('debounceCount');
```

### Tracking –ø–æ–¥—ñ–π –∫–∞–Ω–∞–ª—ñ–≤
```javascript
// –í—Ç—Ä–∞—á–µ–Ω–æ –∞–¥–º—ñ–Ω –ø—Ä–∞–≤–∞
metricsCollector.trackChannelEvent('adminRightsLost');

// –ü–æ–º–∏–ª–∫–∞ –ø—É–±–ª—ñ–∫–∞—Ü—ñ—ó
metricsCollector.trackChannelEvent('publishErrors');

// –í–∏–¥–∞–ª–µ–Ω–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
metricsCollector.trackChannelEvent('messageDeleted');
```

## üõ°Ô∏è –ó–∞—Ö–∏—Å—Ç –≤—ñ–¥ Alert Fatigue

### Debouncing
–ê–ª–µ—Ä—Ç–∏ –∑ –æ–¥–Ω–∞–∫–æ–≤–∏–º signature –Ω–µ –ø–æ–≤—Ç–æ—Ä—é—é—Ç—å—Å—è –ø—Ä–æ—Ç—è–≥–æ–º –ø–µ–≤–Ω–æ–≥–æ —á–∞—Å—É (15 —Ö–≤–∏–ª–∏–Ω –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º):

```javascript
alertManager.config.debounceMinutes = 15;
```

### Rate Limiting
–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∞–ª–µ—Ä—Ç—ñ–≤ –Ω–∞ –≥–æ–¥–∏–Ω—É (20 –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º):

```javascript
alertManager.config.maxAlertsPerHour = 20;
```

### Escalation
–ü–æ–≤—Ç–æ—Ä—é–≤–∞–Ω—ñ –∞–ª–µ—Ä—Ç–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –µ—Å–∫–∞–ª—É—é—Ç—å—Å—è:
- INFO ‚Üí WARN (–ø—ñ—Å–ª—è 3 –ø–æ–≤—Ç–æ—Ä–µ–Ω—å)
- WARN ‚Üí CRITICAL (–ø—ñ—Å–ª—è 3 –ø–æ–≤—Ç–æ—Ä–µ–Ω—å)

```javascript
alertManager.config.escalationThreshold = 3;
```

## üîî –§–æ—Ä–º–∞—Ç –∞–ª–µ—Ä—Ç—ñ–≤

–ê–ª–µ—Ä—Ç–∏ –º—ñ—Å—Ç—è—Ç—å:
- –†—ñ–≤–µ–Ω—å (INFO/WARN/CRITICAL)
- –¢–∏–ø (System/Application/Business/UX/IP/Channel)
- –ó–∞–≥–æ–ª–æ–≤–æ–∫
- –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
- –î–µ—Ç–∞–ª—ñ (–¥–∞–Ω—ñ)
- –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω—É –¥—ñ—é
- –ö—ñ–ª—å–∫—ñ—Å—Ç—å –ø–æ–≤—Ç–æ—Ä–µ–Ω—å
- –ß–∞—Å

–ü—Ä–∏–∫–ª–∞–¥:
```
üö® CRITICAL ‚öôÔ∏è –°–ø–ª–µ—Å–∫ –ø–æ–º–∏–ª–æ–∫

10 –ø–æ–º–∏–ª–æ–∫ –∑–∞ 5 —Ö–≤–∏–ª–∏–Ω

üîÑ –ü–æ–≤—Ç–æ—Ä–µ–Ω–Ω—è: 2 —Ä–∞–∑—ñ–≤

–î–µ—Ç–∞–ª—ñ:
‚Ä¢ errorCount: 10
‚Ä¢ threshold: 10
‚Ä¢ windowMinutes: 5

üí° –î—ñ—è: –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏ —Ç–∞ —Ä–æ–∑–≥–ª—è–Ω—å—Ç–µ —É–≤—ñ–º–∫–Ω–µ–Ω–Ω—è —Ä–µ–∂–∏–º—É –ø–∞—É–∑–∏

‚è∞ 06.02.2026, 19:26:37
```

## üìà –ú–µ—Ç—Ä–∏–∫–∏

### System Metrics
```javascript
{
  uptime: 3600,  // —Å–µ–∫—É–Ω–¥–∏
  uptimeFormatted: "1–≥",
  memory: {
    heapUsedMB: 150,
    heapTotalMB: 200,
    heapUsedPercent: 75,
    rssMB: 180
  },
  process: {
    pid: 12345,
    nodeVersion: "v20.0.0"
  },
  restartCount: 0
}
```

### Application Metrics
```javascript
{
  botPaused: false,
  scheduleInterval: 60,
  errorCount: 5,
  uniqueErrors: 3,
  recentErrors: [...],
  stateTransitionCount: 10,
  recentTransitions: [...]
}
```

### Business Metrics
```javascript
{
  totalUsers: 100,
  activeUsers: 80,
  dau: 50,
  wau: 75,
  channelsConnected: 20,
  ipsMonitored: 15
}
```

## üîß –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è

### –ß–µ—Ä–µ–∑ –ë–î (settings —Ç–∞–±–ª–∏—Ü—è)
```sql
INSERT INTO settings (key, value) VALUES 
  ('alert_debounce_minutes', '15'),
  ('alert_max_per_hour', '20'),
  ('alert_escalation_threshold', '3'),
  ('alert_channel_id', '@my_channel');
```

### –ü—Ä–æ–≥—Ä–∞–º–Ω–æ
```javascript
const { alertManager } = require('./monitoring/alertManager');

alertManager.config.debounceMinutes = 15;
alertManager.config.maxAlertsPerHour = 20;
alertManager.config.escalationThreshold = 3;
alertManager.saveConfig();
```

## üß™ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

–ó–∞–ø—É—Å—Ç–∏—Ç–∏ —Ç–µ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º–∏ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É:
```bash
node test-monitoring.js
```

## üìÅ –§–∞–π–ª–æ–≤–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

```
src/monitoring/
‚îú‚îÄ‚îÄ metricsCollector.js    # –ó–±—ñ—Ä –º–µ—Ç—Ä–∏–∫
‚îú‚îÄ‚îÄ alertManager.js         # –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∞–ª–µ—Ä—Ç–∞–º–∏
‚îî‚îÄ‚îÄ monitoringManager.js    # –ö–æ–æ—Ä–¥–∏–Ω–∞—Ü—ñ—è –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É
```

## ‚úÖ Definition of Done

Monitoring + Alerts –≥–æ—Ç–æ–≤—ñ, —è–∫—â–æ:
- [x] –¢–∏ –∑–Ω–∞—î—à –ø—Ä–æ –ø—Ä–æ–±–ª–µ–º—É –ø–µ—Ä—à–∏–º
- [x] –ú–æ–∂–µ—à —à–≤–∏–¥–∫–æ –≤—ñ–¥—Ä–µ–∞–≥—É–≤–∞—Ç–∏
- [x] –ë–∞—á–∏—à —Å—Ç–∞–Ω —Å–∏—Å—Ç–µ–º–∏
- [x] –†–æ–∑—É–º—ñ—î—à UX-—Å–∏–≥–Ω–∞–ª–∏
- [x] –°–∏—Å—Ç–µ–º–∞ –Ω–µ —à—É–º–∏—Ç—å –¥–∞—Ä–µ–º–Ω–æ

## üîÆ –ú–∞–π–±—É—Ç–Ω—ñ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è

- [ ] Webhook delivery –¥–ª—è –∞–ª–µ—Ä—Ç—ñ–≤ (Slack, Discord)
- [ ] Dashboard –¥–ª—è –≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—ó –º–µ—Ç—Ä–∏–∫
- [ ] –Ü—Å—Ç–æ—Ä–∏—á–Ω—ñ –≥—Ä–∞—Ñ—ñ–∫–∏ –º–µ—Ç—Ä–∏–∫
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω—ñ action triggers (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, auto-pause –ø—Ä–∏ –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö –ø–æ–º–∏–ª–∫–∞—Ö)
- [ ] Machine learning –¥–ª—è –∞–Ω–æ–º–∞–ª—ñ–π detection
- [ ] Performance profiling integration

---

**Monitoring ‚Äî —Ü–µ –æ—á—ñ –ø—Ä–æ–¥—É–∫—Ç—É. –ë–µ–∑ –Ω–∏—Ö —Å–∏—Å—Ç–µ–º–∞ —Å–ª—ñ–ø–∞.**
