# Wizard Notification Target Selection - Visual Guide

## Overview
This feature adds a new step in the wizard flow for new users to choose where they want to receive notifications.

## User Flow for New Users

### Step 1: Select Region
User starts the bot with `/start` command (new user)

```
üëã –ü—Ä–∏–≤—ñ—Ç! –Ø –í–æ–ª—å—Ç–∏–∫ ü§ñ

–î–æ–ø–æ–º–æ–∂—É –≤—ñ–¥—Å–ª—ñ–¥–∫–æ–≤—É–≤–∞—Ç–∏ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è —Å–≤—ñ—Ç–ª–∞ —Ç–∞ —Å–ø–æ–≤—ñ—â—É –∫–æ–ª–∏ –≤–æ–Ω–æ –∑'—è–≤–∏—Ç—å—Å—è —á–∏ –∑–Ω–∏–∫–Ω–µ.

–î–∞–≤–∞–π –Ω–∞–ª–∞—à—Ç—É—î–º–æ! –û–±–µ—Ä–∏ —Å–≤—ñ–π —Ä–µ–≥—ñ–æ–Ω:

[–ö–∏—ó–≤—â–∏–Ω–∞] [–û–¥–µ—â–∏–Ω–∞]
[–î–Ω—ñ–ø—Ä–æ–ø–µ—Ç—Ä–æ–≤—â–∏–Ω–∞] [–•–∞—Ä–∫—ñ–≤—â–∏–Ω–∞]
```

### Step 2: Select Queue
After selecting region, user selects their queue

```
‚úÖ –†–µ–≥—ñ–æ–Ω: –ö–∏—ó–≤

2Ô∏è‚É£ –û–±–µ—Ä—ñ—Ç—å —á–µ—Ä–≥—É:

[1.1] [1.2] [2.1]
[2.2] [3.1] [3.2]
[4.1] [4.2] [5.1]
[5.2] [6.1] [6.2]
[‚Üê –ù–∞–∑–∞–¥]
```

### Step 3: Select Notification Target (NEW!)
After selecting queue, user chooses where to receive notifications

```
‚úÖ –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è:

üìç –†–µ–≥—ñ–æ–Ω: –ö–∏—ó–≤
‚ö°Ô∏è –ß–µ—Ä–≥–∞: 1.1

üì¨ –ö—É–¥–∏ –Ω–∞–¥—Å–∏–ª–∞—Ç–∏ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è –ø—Ä–æ —Å–≤—ñ—Ç–ª–æ/–≥—Ä–∞—Ñ—ñ–∫–∏?

–û–±–µ—Ä—ñ—Ç—å, –¥–µ –≤–∞–º –∑—Ä—É—á–Ω—ñ—à–µ —ó—Ö –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏:

üì± –£ —Ü—å–æ–º—É –±–æ—Ç—ñ
–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–∏—Ö–æ–¥–∏—Ç–∏–º—É—Ç—å –ø—Ä—è–º–æ –≤ —Ü–µ–π —á–∞—Ç

üì∫ –£ –≤–∞—à–æ–º—É Telegram-–∫–∞–Ω–∞–ª—ñ
–ë–æ—Ç –ø—É–±–ª—ñ–∫—É–≤–∞—Ç–∏–º–µ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è —É –≤–∞—à –∫–∞–Ω–∞–ª
(–ø–æ—Ç—Ä—ñ–±–Ω–æ –¥–æ–¥–∞—Ç–∏ –±–æ—Ç–∞ —è–∫ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞)

[üì± –£ —Ü—å–æ–º—É –±–æ—Ç—ñ]
[üì∫ –£ Telegram-–∫–∞–Ω–∞–ª—ñ]
```

## Option A: User Selects "In This Bot"

### Result
```
‚úÖ –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∑–∞–≤–µ—Ä—à–µ–Ω–æ!

üìç –†–µ–≥—ñ–æ–Ω: –ö–∏—ó–≤
‚ö°Ô∏è –ß–µ—Ä–≥–∞: 1.1
üì¨ –°–ø–æ–≤—ñ—â–µ–Ω–Ω—è: —É —Ü–µ–π —á–∞—Ç

–°–ø–æ–≤—ñ—â–µ–Ω–Ω—è –ø—Ä–∏—Ö–æ–¥–∏—Ç–∏–º—É—Ç—å —É —Ü–µ–π —á–∞—Ç.
```

*After 2 seconds, main menu appears*

```
üè† –ì–æ–ª–æ–≤–Ω–µ –º–µ–Ω—é

[üìä –ì—Ä–∞—Ñ—ñ–∫] [‚è± –¢–∞–π–º–µ—Ä]
[üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞] [‚ùì –î–æ–ø–æ–º–æ–≥–∞]
[‚öôÔ∏è –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è]
```

## Option B: User Selects "In Telegram Channel"

### Step 4: Channel Connection Instructions
```
üì∫ –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è Telegram-–∫–∞–Ω–∞–ª—É

–©–æ–± –±–æ—Ç –º—ñ–≥ –ø—É–±–ª—ñ–∫—É–≤–∞—Ç–∏ —É –≤–∞—à –∫–∞–Ω–∞–ª:

1Ô∏è‚É£ –°—Ç–≤–æ—Ä—ñ—Ç—å –∫–∞–Ω–∞–ª –∞–±–æ –≤—ñ–¥–∫—Ä–∏–π—Ç–µ —ñ—Å–Ω—É—é—á–∏–π
2Ô∏è‚É£ –î–æ–¥–∞–π—Ç–µ –±–æ—Ç–∞ —è–∫ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞
3Ô∏è‚É£ –ù–∞–¥–∞–π—Ç–µ –ø—Ä–∞–≤–∞ –Ω–∞ –ø—É–±–ª—ñ–∫–∞—Ü—ñ—é –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
4Ô∏è‚É£ –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "üîÑ –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏" –Ω–∏–∂—á–µ

‚ÑπÔ∏è –¶–µ –∑–∞–π–º–µ –º–µ–Ω—à–µ —Ö–≤–∏–ª–∏–Ω–∏

[üîÑ –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏]
[‚Üê –ù–∞–∑–∞–¥]
```

### Step 5: Channel Detection
After user adds bot as admin and clicks "–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏"

```
üì∫ –ó–Ω–∞–π–¥–µ–Ω–æ –∫–∞–Ω–∞–ª!

–ö–∞–Ω–∞–ª: –ú—ñ–π –ö–∞–Ω–∞–ª
(@mychannel)

–ü—ñ–¥–∫–ª—é—á–∏—Ç–∏ —Ü–µ–π –∫–∞–Ω–∞–ª?

[‚úì –¢–∞–∫, –ø—ñ–¥–∫–ª—é—á–∏—Ç–∏] [‚úï –ù—ñ]
```

### Step 6: Channel Name Setup
After confirming channel

```
üìù –í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É –¥–ª—è –∫–∞–Ω–∞–ª—É

–í–æ–Ω–∞ –±—É–¥–µ –¥–æ–¥–∞–Ω–∞ –ø—ñ—Å–ª—è –ø—Ä–µ—Ñ—ñ–∫—Å—É "–í–æ–ª—å—Ç–∏–∫ ‚ö°Ô∏è "

–ü—Ä–∏–∫–ª–∞–¥: –ö–∏—ó–≤ –ß–µ—Ä–≥–∞ 3.1
–†–µ–∑—É–ª—å—Ç–∞—Ç: –í–æ–ª—å—Ç–∏–∫ ‚ö°Ô∏è –ö–∏—ó–≤ –ß–µ—Ä–≥–∞ 3.1
```

User types: `–ö–∏—ó–≤ –ß–µ—Ä–≥–∞ 1.1`

### Step 7: Optional Description
```
üìù –•–æ—á–µ—Ç–µ –¥–æ–¥–∞—Ç–∏ –¥–æ–¥–∞—Ç–∫–æ–≤–∏–π –æ–ø–∏—Å –∫–∞–Ω–∞–ª—É?

–ù–∞–ø—Ä–∏–∫–ª–∞–¥: –ñ–ö "–°–æ–Ω—è—á–Ω–∏–π", –ø—ñ–¥'—ó–∑–¥ 2

[‚úçÔ∏è –î–æ–¥–∞—Ç–∏ –æ–ø–∏—Å] [‚è≠Ô∏è –ü—Ä–æ–ø—É—Å—Ç–∏—Ç–∏]
```

### Step 8: Channel Setup Complete
```
‚úÖ –ö–∞–Ω–∞–ª —É—Å–ø—ñ—à–Ω–æ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ!

üì∫ –ö–∞–Ω–∞–ª: @mychannel
üìù –ù–∞–∑–≤–∞: –í–æ–ª—å—Ç–∏–∫ ‚ö°Ô∏è –ö–∏—ó–≤ –ß–µ—Ä–≥–∞ 1.1

‚ö†Ô∏è –£–í–ê–ì–ê: –ù–µ –∑–º—ñ–Ω—é–π—Ç–µ –Ω–∞–∑–≤—É, –æ–ø–∏—Å –∞–±–æ —Ñ–æ—Ç–æ –∫–∞–Ω–∞–ª—É!
–Ø–∫—â–æ –≤–∏ —ó—Ö –∑–º—ñ–Ω–∏—Ç–µ ‚Äî –±–æ—Ç –ø–µ—Ä–µ—Å—Ç–∞–Ω–µ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ —ñ
–ø–æ—Ç—Ä—ñ–±–Ω–æ –±—É–¥–µ –Ω–∞–ª–∞—à—Ç–æ–≤—É–≤–∞—Ç–∏ –∫–∞–Ω–∞–ª –∑–∞–Ω–æ–≤–æ.
```

*After 4 seconds, main menu appears*

```
üè† –ì–æ–ª–æ–≤–Ω–µ –º–µ–Ω—é

[üìä –ì—Ä–∞—Ñ—ñ–∫] [‚è± –¢–∞–π–º–µ—Ä]
[üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞] [‚ùì –î–æ–ø–æ–º–æ–≥–∞]
[‚öôÔ∏è –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è]
[üõë –¢–∏–º—á–∞—Å–æ–≤–æ –∑—É–ø–∏–Ω–∏—Ç–∏ –∫–∞–Ω–∞–ª]
```

## Back Navigation

At the notification target selection step, user can go back:

```
[‚Üê –ù–∞–∑–∞–¥] ‚Üí Returns to notification target selection
```

During channel connection, user can go back:

```
[‚Üê –ù–∞–∑–∞–¥] ‚Üí Returns to notification target selection
```

## Database Changes

When user selects notification target:
- **"In This Bot"**: `power_notify_target = 'bot'`
- **"In Telegram Channel"**: `power_notify_target = 'channel'`

## Technical Implementation

### Files Modified
1. `src/keyboards/inline.js` - Added `getWizardNotifyTargetKeyboard()`
2. `src/handlers/start.js` - Added wizard notification target handlers
3. `src/bot.js` - Updated callback routing

### New Callback Handlers
- `wizard_notify_bot` - User selects bot notifications
- `wizard_notify_channel` - User selects channel notifications
- `wizard_notify_back` - User goes back to notification selection
- `wizard_channel_confirm_*` - User confirms channel selection

### Integration with Existing Code
- Leverages existing `pendingChannels` mechanism from channel.js
- Uses existing `conversationStates` for channel setup flow
- Reuses existing channel branding and setup logic
- Main menu display already handled by existing channel setup completion

## Benefits

1. **Clear User Intent**: Users explicitly choose their notification preference during setup
2. **Reduced Friction**: Users who only want bot notifications don't need to deal with channel setup
3. **Guided Experience**: Users who want channel notifications get step-by-step guidance
4. **Consistent Flow**: Integrates seamlessly with existing wizard and channel setup flows
5. **Database Ready**: `power_notify_target` field already exists in database schema

## Notes

- This change only affects **NEW users** going through the wizard
- Existing users are not affected
- Users in "edit mode" (changing region/queue) bypass this step
- Channel setup can be done later via Settings if user selects bot notifications initially
